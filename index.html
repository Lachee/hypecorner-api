<html>
    <style>
        * { padding: 0; margin: 0; }
    </style>
    <body>
        <!-- Add a placeholder for the Twitch embed -->
        <div id="twitch-embed"></div>

        <!-- Load the Twitch embed script -->
        <script src="https://embed.twitch.tv/embed/v1.js"></script>

        <!-- Create a Twitch.Embed object that will render within the "twitch-embed" root element. -->
        <script type="text/javascript">
            fetch("/channel").then((data) => {
                data.json().then(json => {
                    var twitchEmbed = new Twitch.Embed("twitch-embed", {
                        width: 854,
                        height: 480,
                        channel: json.name,
                        layout: "video-chat",
                        height: "100%",
                        width: "100%",
                    });

                    const ws = new WebSocket("ws://" + window.location.host + "/listen");
                    ws.addEventListener("open", (event) => { console.log("open", event);  });
                    ws.addEventListener("close", (event) => { console.error("Live Watch has terminated"); });
                    ws.addEventListener("message", (event) => { 
                        console.log(event);
                        twitchEmbed.setChannel(event.data);
                    });
                    function abort() { ws.close(); }
                });
            });
        </script>
        
		<!-- Live Updating -->
		<script>
	
		</script>
    </body>
</html>